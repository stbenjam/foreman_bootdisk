#!ipxe
set menu-timeout 5000
set submenu-timeout ${menu-timeout}
set provision-url <%= Setting[:unattended_url] %>
set next-step dhcp

:start
menu Bootdisk Menu
item --gap --             ---------------------- Network Configuration ------------------
item --key a dhcp         (A)utomatic Network Configuration (DHCP)
item --key m config       Enter (M)anual Configuration
item --gap --             ---------------------------------------------------------------
item --key c bootdisk     (C)ontinue
item
item --key r reboot       (R)eboot computer
item --key x exit         E(x)it iPXE and continue BIOS boot
choose --timeout ${menu-timeout} --default ${next-step} selected || goto start
goto ${selected}

:dhcp
dhcp
set next-step bootdisk
goto start

:config
config
set next-step bootdisk
goto start

:bootdisk
menu Bootdisk Menu
item --gap --             ---------------------------- Bootdisk -------------------------
item --key e existing     Boot from (e)xisting host record
item --key g hostgroup    Create new host from host (g)roup
item --gap --             ------------------------- Advanced options --------------------
item --key c override     (C)ustom Provisioning URL
item
item --key r reboot       (R)eboot computer
item --key x exit         E(x)it iPXE and continue BIOS boot
choose --timeout ${menu-timeout} --default net0 selected || goto cancel
set menu-timeout 0
goto ${selected}

:failed
echo Booting failed
exit

:reboot
reboot

:exit
exit

:existing
chain <%= bootdisk_chain_url %>${netX/mac}

:hostgroup
chain <%= foreman_url('hostgroup') %>

:override
echo
echo
echo Customize provisioning URL:
read provision_url
goto start
